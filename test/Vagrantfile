# -*- mode: ruby -*-
# vi: set ft=ruby :

$provisionSh = <<-SHELL
    set -e
    set -x

    export LANG=en_US.UTF-8

    # add EPEL repo for extra packages
    echo "### Add epel repo ###" > CentOS_upgrade.txt
    sudo yum -y install epel-release >> CentOS_upgrade.txt 2>&1

    echo "Updating OS..."
    echo "### Update ###" >> CentOS_upgrade.txt
    sudo yum -q -y update >> CentOS_upgrade.txt 2>&1
    echo "### Upgrade ###" >> CentOS_upgrade.txt
    sudo yum -q -y upgrade >> CentOS_upgrade.txt 2>&1

    echo "[hoot]" | sudo tee /etc/yum.repos.d/hoot.repo
    echo "name=hoot" | sudo tee -a /etc/yum.repos.d/hoot.repo
    echo "baseurl=file:///home/vagrant/el7/" | sudo tee -a /etc/yum.repos.d/hoot.repo
    echo "gpgcheck=0" | sudo tee -a /etc/yum.repos.d/hoot.repo

    sudo yum -y -q update --exclude=puppet*
    echo "Install Hootenanny..."
    sudo yum -y install hootenanny-autostart

 SHELL

Vagrant.configure(2) do |config|
  config.vm.box = "hoot/centos7-minimal"
  config.vm.hostname = "hoot-centos"

  config.vm.synced_folder "../el7", "/home/vagrant/el7"
  config.vm.synced_folder ".", "/home/vagrant/tmp"

  config.vm.provision "shell", inline: $provisionSh

  # Provider-specific configuration so you can fine-tune various
  # backing providers for Vagrant. These expose provider-specific options.
  # Example for VirtualBox:
  #
  config.vm.provider "virtualbox" do |vb|
      # Customize the amount of memory on the VM:
      vb.memory = 4096
      vb.cpus = 2
  end
end

# Allow local overrides of vagrant settings
if File.exists?('VagrantfileLocal')
  load 'VagrantfileLocal'
else
  if File.exists?('VagrantfileLocal.vbox')
    load 'VagrantfileLocal.vbox'
  end
end